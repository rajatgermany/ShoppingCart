angular.module("AuthenticationApp",[]).controller("AuthenticationController",["$scope","$state","$rootScope","RegisterFactory","LoginFactory","$localStorage","GetTokenFactory","$window","$modal","$alert","userFactory","$q",function(e,t,r,o,a,n,i,c,u,d,l,s){var p=u({scope:e,templateUrl:"/components/Authentication/registerView.html",show:!1});e.$on("$stateChangeSuccess",function(e,r){"Register"==r.name&&o.register().then(function(e){d({title:"User Registered!",content:"Please Login Now",animation:"am-fade-and-slide-top",placement:"top",type:"info",keyboard:!1,container:"body",show:!0}),t.go("Login")},function(e){})}),e.LoginUser=function(o){e.newUser=new a,e.newUser.LoginData=o,a.save(e.newUser,function(e){0==e.success?alert(e.message):(n.newToken=e.token,c.location.reload(),t.go("home"))},function(e){r.message="Something went wrong ! Please Try again"})},e.RegisterUser=function(e){o.register(e)},e.ShowModalRegister=function(){p.$promise.then(p.show)}}]),angular.module("AuthenticationApp").factory("GetTokenFactory",["$localStorage",function(e){var t={};return t.GetToken=function(e){return!!e},t}]),angular.module("AuthenticationApp").factory("LoginFactory",["$resource",function(e){return e("api/user/Login")}]),angular.module("AuthenticationApp").factory("RegisterFactory",["$resource","$rootScope","$modal","$q","$alert",function(e,t,r,o,a){var n={},i=e("api/user/Register");return n.register=function(e){var n=t.$new(),c=r({templateUrl:"components/Authentication/registerView.html",scope:n,show:!0}),u=o.defer();return n.newUser=new i,n.newUser.data=e,i.save(n.newUser,function(){a({title:"Registration Successfull!",content:"Please Login",animation:"am-fade-and-slide-top",placement:"top",type:"info",keyboard:!1,container:"body",show:!0}),c.hide()},function(e){a({title:"Registration Unsuccessful!",animation:"am-fade-and-slide-top",placement:"top",type:"info",keyboard:!1,container:"body",show:!0})}),u.promise},n}]),angular.module("cart",[]).controller("cartController",["$scope","cartFactory","userFactory","$window","$state","$q","$alert",function(e,t,r,o,a,n,i){var c=t.ItemCount();c.then(function(){return t.getCart()}).then(function(t){e.cart=t}),e.Remove=function(r){var o=t.RemoveProduct(r);o.then(function(t){"cancelled"==t||(e.cart=t,i({title:"Cart Updated",animation:"am-fade-and-slide-top",placement:"top",type:"info",keyboard:!1,container:"body",show:!0}))}).then(function(){e.$emit("myEvent","yo")})},e.Home=function(){a.go("home")}}]),angular.module("cart").directive("cartDirective",function(){return{restrict:"E",templateUrl:"/cart/cartDirectiveTemplate.html"}}),angular.module("cart").service("cartFactory",["CartResourceFactory","userFactory","$q",function(e,t,r){var o={};return o.CartData=[],o.count=0,o.CartID=null,o.ItemCount=function(){var a=r.defer();return t.query().$promise.then(function(t){null==t[0].cart?(cartUser=t[0].Token,a.resolve(o.count)):e.get({cart_id:t[0].cart}).$promise.then(function(e){o.CartData=e.Product,o.CartID=e._id,o.count=0;for(var t=0;t<e.Product.length;t++)o.count=parseInt(o.count)+parseInt(e.Product[t].Quantity);a.resolve(o.count)})}),a.promise},o.addProduct=function(t){var a=r.defer(),n=!1;if(null==o.CartID&&0==o.CartData.length){o.CartData.push({id:t._id,Quantity:t.Quantity,Name:t.Name,Category:t.Category,Price:t.Price});var i=new e;i.data=o.CartData,e.save(i.data,function(e){a.resolve(o.count)}),n=!0}else for(var c=0;c<o.CartData.length;c++)if(o.CartData[c].id==t._id){o.CartData[c].Quantity=parseInt(o.CartData[c].Quantity)+parseInt(t.Quantity),e.update({Cart:o.CartData,cart_id:o.CartID},function(e){a.resolve(o.count)}),n=!0;break}return 0==n&&(o.CartData.push({id:t._id,Quantity:t.Quantity,Name:t.Name,Category:t.Category,Price:t.Price}),e.update({Cart:o.CartData,cart_id:o.CartID},function(){a.resolve(o.count)})),a.promise},o.getCart=function(){var t=r.defer();return e.get({cart_id:o.CartID}).$promise.then(function(e){t.resolve(e.Product)}),t.promise},o.Total=function(){for(var e=0,t=0;t<o.CartData.length;t++)e+=o.CartData[t].Price*parseInt(o.CartData[t].Quantity);return e},o.RemoveProduct=function(t){var a=r.defer();if(1==confirm("Are You Sure")){x="You pressed OK!";for(var n=0,i=0;i<o.CartData.length;i++)if(o.CartData[i].id==t.id){n=i;break}o.CartData.splice(n,1),e.update({Cart:o.CartData,cart_id:o.CartID}).$promise.then(function(e){a.resolve(o.CartData)})}else a.resolve("cancelled");return a.promise},o}]),angular.module("cart").factory("CartResourceFactory",["$resource","$localStorage",function(e,t){function r(){var e=t.newToken;return{Authorization:e}}var o=r(),a={get:{method:"GET",headers:o},save:{method:"POST",headers:o},create:{method:"POST",headers:o},query:{method:"GET",isArray:!0,headers:o},remove:{method:"DELETE",headers:o},delete:{method:"DELETE",headers:o},update:{method:"PUT",headers:o}};e("/api/movies/:id",{id:"@id"},a);var n=e("/api/cart/Cart/:cart_id",{cart_id:"@cart_id"},a);return n}]),angular.module("editProduct",[]).controller("editProductController",["$scope","$stateParams","resourceFactory","cartFactory",function(e,t,r,o){r.get({product_id:t.product_id},function(t){e.product=t}),e.AddToCart=function(t){Promise=o.addProduct(t),Promise.then(function(t){e.$emit("myEvent","yo")})}}]),angular.module("homeApp",[]).controller("homeController",["$rootScope","$scope","resourceFactory","homeFactory","ActiveProduct","cartFactory","userFactory",function(e,t,r,o,a,n,i){var c=null;t.cart=[],t.size=3,t.newpage=1,t.products=r.query(function(e,r){console.log(e),i.query().$promise.then(function(e){t.User=e[0].Name})},function(e){}),t.Like=function(e){t.like=!0,o.update({id:e,like:t.like},function(e){},function(e){console.log(e)})},t.selectCategory=function(e){t.newpage=1,c=e,t.CategoryFilter=e},t.SelectedPage=function(e){t.newpage=e},t.getClass=function(e){return c==e?a:null},t.getPageClass=function(e){return t.newpage==e?a:null},t.AddToCart=function(e){Promise=n.addProduct(e),Promise.then(function(e){t.$emit("myEvent","yo")})}}]),angular.module("homeApp").factory("homeFactory",["$resource","$localStorage",function(e,t){function r(){var e=t.newToken;return{Authorization:e}}var o=r(),a={get:{method:"GET",headers:o},save:{method:"POST",headers:o},create:{method:"POST",headers:o},query:{method:"GET",isArray:!0,headers:o},remove:{method:"DELETE",headers:o},delete:{method:"DELETE",headers:o},update:{method:"PUT",headers:o}},n=e("/api/user/AddLike/:id",{id:"@id"},a);return n}]),angular.module("homeApp").filter("newFilter",["$filter",function(e){return function(t,r,o){var a=(r-1)*o;return t.length<a?[]:e("limitTo")(t.splice(a),o)}}]).filter("pagecount",function(){return function(e,t){for(var r=[],o=0;o<Math.ceil(e.length)/t;o++)r.push(o);return r}});var app=angular.module("MovieApp",["ui.router","ngResource","shared","homeApp","placeOrder","editProduct","resourceFactory","AuthenticationApp","ngStorage","angular.filter","cart","placeOrder","navBar","elasticsearch","viewProduct","mgcrea.ngStrap.modal","mgcrea.ngStrap.aside","mgcrea.ngStrap.tooltip","mgcrea.ngStrap.alert","ngAnimate"]);app.config(["$modalProvider",function(e){angular.extend(e.defaults,{animation:"am-flip-x"})}]),app.constant("ActiveProduct","btn-primary"),app.run(["GetTokenFactory","$localStorage","$rootScope","$state","$alert",function(e,t,r,o,a){r.preventNavigation=!1,r.$on("$stateChangeStart",function(o,n,i){0!=n.authenticate&&(!e.GetToken(t.newToken)||r.preventNavigation&&!confirm("You have unsaved changes, do you want to continue?"))&&(o.preventDefault(),a({title:"Login First!",content:"",placement:"top",type:"info",show:!0}))})}]),app.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/user/login"),e.state("home",{url:"/home",templateUrl:"/components/home/homeView.html",controller:"homeController"}).state("ViewCart",{url:"/view/cart",templateUrl:"/components/cart/cartView.html",controller:"cartController"}).state("EditProduct",{url:"/edit/product/:product_id",templateUrl:"/components/editProduct/editProductView.html",controller:"editProductController"}).state("Register",{url:"/user/signup",templateUrl:"/components/Authentication/registerView.html",controller:"AuthenticationController",authenticate:!1}).state("Login",{url:"/user/login",templateUrl:"/components/Authentication/LoginView.html",controller:"AuthenticationController",authenticate:!1}).state("PlaceOrder",{url:"/placeOrder",templateUrl:"/components/placeOrder/placeOrderView.html",controller:"placeOrderController.js"}).state("ShippingDetails",{url:"/add/shippingdetails",templateUrl:"/components/placeOrder/EditShippingDetails.html",controller:"placeOrderController.js"}).state("SearchProduct",{url:"/search/product",templateUrl:"components/mainApp/searchProductView.html",controller:"mainAppController"}).state("ViewProduct",{url:"/view/product/:product_id",templateUrl:"components/viewProduct/viewProductView.html",controller:"viewProductController"})}]),app.directive("rajat",function(){return{restrict:"EA",templateUrl:"components/mainapp/ProductDirective.html",scope:{data:"=",like:"&",add:"&"},link:function(e,t,r){e.a="from the directive"}}}),angular.module("MovieApp").controller("mainAppController",["$scope","searchFactory","$state","$location",function(e,t,r,o){e.show=!1,e.product=null,e.search=function(){var a=t.search(e.product);a.then(function(t){o.search({id:e.product}),r.go("SearchProduct"),o.search({id:e.product}),e.item=t})}}]),angular.module("MovieApp").factory("searchFactory",["esFactory","$q","$location",function(e,t,r){var o=e({host:r.host()+":9200"}),a={};return a.search=function(e){r.search({id:e}),console.log(e);var a=t.defer();return o.search({index:"shoppings",type:"shopping",body:{query:{match:{_all:e}}}}).then(function(e){console.log(e);for(var t=e.hits.hits,r=[],o=0;o<t.length;o++)r.push(t[o]);a.resolve(r)},function(e){a.resolve(e)}),a.promise},a}]),angular.module("placeOrder",[]).controller("placeOrderController.js",["$scope","cartFactory","userFactory","placeOrderFactory","$state","$modal",function(e,t,r,o,a,n){var i=n({scope:e,templateUrl:"/components/placeOrder/editShippingModal.html",show:!1});e.$on("$stateChangeSuccess",function(t,o){"ShippingDetails"==o.name?r.query(function(t){t[0].ShippingAddress.Entry?(e.Form=!0,e.Data=!1,e.newForm=!1):(e.Form=!1,e.Data=!1,e.newForm=!0,e.ShippingDetails=t[0].ShippingAddress)}):"PlaceOrder"==o.name&&r.query(function(t){t[0].ShippingAddress.Entry?(e.Form=!0,e.Data=!1,e.newForm=!1):(e.Form=!1,e.Data=!0,e.newForm=!1,e.Name=t[0].ShippingAddress.Name,e.Address=t[0].ShippingAddress.Address)})}),e.addDetails=function(r){e.order=new o,e.order.data=r,e.order.CartID=t.CartID,o.save(e.order,function(e){i.$promise.then(i.show)})},e.EditShipping=function(){a.go("ShippingDetails")},e.GoHome=function(){i.$promise.then(i.hide),a.go("ViewCart")}}]),angular.module("placeOrder").factory("placeOrderFactory",["$resource","$localStorage",function(e,t){function r(){var e=t.newToken;return{Authorization:e}}var o=r(),a={get:{method:"GET",headers:o},save:{method:"POST",headers:o},create:{method:"POST",headers:o},query:{method:"GET",isArray:!0,headers:o},remove:{method:"DELETE",headers:o},delete:{method:"DELETE",headers:o},update:{method:"PUT",headers:o}},n=e("/api/order/ShippingDetails",{product_id:"@product_id"},a);return n}]),angular.module("viewProduct",[]).controller("viewProductController",["$scope","$stateParams","resourceFactory","cartFactory",function(e,t,r,o){r.get({product_id:t.product_id},function(t){console.log(t),e.product=t}),e.AddToCart=function(t){Promise=o.addProduct(t),Promise.then(function(t){e.$emit("myEvent","yo")})}}]),angular.module("navBar",[]).directive("navdirective",["$localStorage","$state","$location","$window","$rootScope","GetTokenFactory","cartFactory","$modal","$alert",function(e,t,r,o,a,n,i,c,u){return{restrict:"E",templateUrl:"components/shared/navbar/navBarTemplate.html",link:function(r,o,n){r.Logout=function(){var o=a.$new();o.items=r.ItemCount,o.response=function(o){"yes"==o?(delete e.newToken,r.ItemCount=0,r.Total=0,n.hide(),t.go("Login"),u({title:"Please Login to Continue!",animation:"am-fade-and-slide-top",placement:"top",type:"info",keyboard:!1,container:"body",show:!0})):"no"==o&&(n.hide(),u({title:"Continue Shopping!",animation:"am-fade-and-slide-top",placement:"top",type:"info",keyboard:!1,container:"body",show:!0}))};var n=c({templateUrl:"components/shared/navbar/LogoutView.html",scope:o,show:!0})},i.ItemCount().then(function(e){r.ItemCount=e,r.Total=i.Total()},function(e){r.error="has failed... "+e}),r.$on("myEvent",function(e,t){i.ItemCount().then(function(e){r.ItemCount=e,r.data=i.CartData,r.Total=i.Total()},function(e){r.error="has failed... "+e})}),r.class=function(){return"a"}}}}]),angular.module("resourceFactory",[]).factory("resourceFactory",["$resource","$localStorage",function(e,t){function r(){var e=t.newToken;return{Authorization:e}}var o=r(),a={get:{method:"GET",headers:o},save:{method:"POST",headers:o},create:{method:"POST",headers:o},query:{method:"GET",isArray:!0,headers:o},remove:{method:"DELETE",headers:o},delete:{method:"DELETE",headers:o},update:{method:"PUT",headers:o}},n=e("/api/user/products/:product_id",{product_id:"@product_id"},a);return n}]),angular.module("shared",[]).factory("userFactory",["$resource","$localStorage",function(e,t){function r(){var e=t.newToken;return console.log("Ge the Token"),{Authorization:e}}var o=r(),a={get:{method:"GET",headers:o},save:{method:"POST",headers:o},create:{method:"POST",headers:o},query:{method:"GET",isArray:!0,headers:o},remove:{method:"DELETE",headers:o},delete:{method:"DELETE",headers:o},update:{method:"PUT",headers:o}},n=e("/api/user/GetUser",{id:"@id"},a);return n}]);